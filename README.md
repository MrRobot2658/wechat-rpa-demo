# WeChat RPA - åŸºäº AccessibilityService çš„ä¼ä¸šå¾®ä¿¡è‡ªåŠ¨åŒ–æ–¹æ¡ˆ

> ä¸€ä¸ªåŸºäº Android å®˜æ–¹æ— éšœç¢æœåŠ¡ï¼ˆAccessibilityServiceï¼‰çš„ä¼ä¸šå¾®ä¿¡/å¾®ä¿¡è‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œæ”¯æŒæ”¶å‘æ¶ˆæ¯ã€è‡ªåŠ¨æ‹‰ç¾¤ã€ç¾¤ç®¡ç†ç­‰åŠŸèƒ½ã€‚é‡‡ç”¨ç»è¿‡ç¤¾åŒºéªŒè¯çš„æœ€ä½³å®è·µæ¶æ„ã€‚

**å…è´£å£°æ˜ï¼š** æœ¬é¡¹ç›®ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶å’Œå­¦ä¹ ç›®çš„ã€‚è‡ªåŠ¨åŒ–æ“ä½œå¾®ä¿¡/ä¼ä¸šå¾®ä¿¡å¯èƒ½è¿åå…¶ç”¨æˆ·åè®®ï¼Œå­˜åœ¨è¢«é™åˆ¶åŠŸèƒ½ç”šè‡³å°å·çš„é£é™©ã€‚ä½¿ç”¨è€…å¿…é¡»è‡ªè¡Œæ‰¿æ‹…æ‰€æœ‰é£é™©å’Œåæœã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© AccessibilityServiceï¼Ÿ

æœ¬é¡¹ç›®ä» `uiautomator2` æ–¹æ¡ˆå‡çº§ä¸º **AccessibilityService** æ–¹æ¡ˆï¼Œè¿™æ˜¯ç»è¿‡ [WorkTool](https://github.com/gallonyin/worktool)ï¼ˆ3k+ Starsï¼‰ç­‰å¤šä¸ªæˆåŠŸå¼€æºé¡¹ç›®éªŒè¯çš„æœ€ä½³å®è·µã€‚

| å¯¹æ¯”ç»´åº¦ | AccessibilityServiceï¼ˆæœ¬æ–¹æ¡ˆï¼‰ | uiautomator2ï¼ˆæ—§æ–¹æ¡ˆï¼‰ |
|---------|-------------------------------|----------------------|
| **ç¨³å®šæ€§** | é«˜ï¼Œç³»ç»Ÿçº§å¸¸é©»æœåŠ¡ï¼Œé•¿æ—¶é—´è¿è¡Œç¨³å®š | ä½ï¼Œatx-agent å®ˆæŠ¤è¿›ç¨‹æ˜“æ–­è¿ |
| **éƒ¨ç½²æ–¹å¼** | ç‹¬ç«‹ APKï¼Œå®‰è£…å³ç”¨ï¼Œæ— éœ€ç”µè„‘æŒç»­è¿æ¥ | éœ€è¦ PC ç«¯ Python é€šè¿‡ ADB æŒç»­é©±åŠ¨ |
| **å“åº”é€Ÿåº¦** | å¿«ï¼Œè¿›ç¨‹å†…ç›´æ¥è°ƒç”¨ç³»ç»Ÿ API | æ…¢ï¼Œè·¨è¿›ç¨‹ HTTP + ADB å¤šå±‚é€šä¿¡ |
| **å…¼å®¹æ€§** | 99%+ Android 7.0+ è®¾å¤‡ | ä¾èµ– ADB è¿æ¥å’Œ atx-agent ç‰ˆæœ¬ |
| **åˆè§„æ€§** | åŸºäºå®˜æ–¹æ— éšœç¢ SDK | åŸºäºæµ‹è¯•æ¡†æ¶ï¼Œéè®¾è®¡ç”¨é€” |
| **å¤šè®¾å¤‡æ‰©å±•** | æ¯å°è®¾å¤‡ç‹¬ç«‹è¿è¡Œï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤ | æ¯å°è®¾å¤‡éœ€ä¸€ä¸ª PC ç«¯è¿›ç¨‹é©±åŠ¨ |

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨ç³»ç»Ÿ / å¼€å‘è€…                       â”‚
â”‚              (CRMã€å®¢æœç³»ç»Ÿã€è‡ªå®šä¹‰è„šæœ¬)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP API (ç«¯å£ 8080)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Python æœåŠ¡ç«¯ (FastAPI)                      â”‚
â”‚         å¤šè®¾å¤‡ç®¡ç† Â· ä»»åŠ¡è°ƒåº¦ Â· ç»Ÿä¸€APIç½‘å…³                 â”‚
â”‚         Swaggeræ–‡æ¡£: http://localhost:8080/docs           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP API (å±€åŸŸç½‘, ç«¯å£ 9527)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Android è®¾å¤‡ (æ‰‹æœº/äº‘æ‰‹æœº)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         RPA App (æœ¬é¡¹ç›® Android ç«¯)               â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  HttpServerService â”€â”€â†’ TaskController             â”‚    â”‚
â”‚  â”‚  (NanoHTTPD:9527)      (ä»»åŠ¡é˜Ÿåˆ—,ä¸²è¡Œæ‰§è¡Œ)          â”‚    â”‚
â”‚  â”‚                             â”‚                     â”‚    â”‚
â”‚  â”‚                             â–¼                     â”‚    â”‚
â”‚  â”‚                      WeworkOperator               â”‚    â”‚
â”‚  â”‚                      (ä¸šåŠ¡é€»è¾‘å°è£…)                 â”‚    â”‚
â”‚  â”‚                             â”‚                     â”‚    â”‚
â”‚  â”‚                             â–¼                     â”‚    â”‚
â”‚  â”‚                 RpaAccessibilityService            â”‚    â”‚
â”‚  â”‚                 (æ§ä»¶æŸ¥æ‰¾ Â· æ¨¡æ‹Ÿç‚¹å‡» Â· æ‰‹åŠ¿)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            ä¼ä¸šå¾®ä¿¡ / å¾®ä¿¡ å®¢æˆ·ç«¯                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®ç»“æ„

```
wechat-rpa-demo/
â”‚
â”œâ”€â”€ android-app/                              # ===== Android ç«¯åº”ç”¨ =====
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ build.gradle                      # Gradle æ„å»ºé…ç½®
â”‚       â””â”€â”€ src/main/
â”‚           â”œâ”€â”€ AndroidManifest.xml            # åº”ç”¨æ¸…å•
â”‚           â”œâ”€â”€ java/com/wechatrpa/
â”‚           â”‚   â”œâ”€â”€ RpaApplication.kt          # Application å…¥å£
â”‚           â”‚   â”œâ”€â”€ activity/
â”‚           â”‚   â”‚   â””â”€â”€ MainActivity.kt        # ä¸»ç•Œé¢ï¼ˆçŠ¶æ€å±•ç¤ºã€æœåŠ¡æ§åˆ¶ï¼‰
â”‚           â”‚   â”œâ”€â”€ service/
â”‚           â”‚   â”‚   â”œâ”€â”€ RpaAccessibilityService.kt  # [æ ¸å¿ƒ] æ— éšœç¢æœåŠ¡
â”‚           â”‚   â”‚   â”œâ”€â”€ WeworkOperator.kt            # [æ ¸å¿ƒ] ä¼å¾®æ“ä½œå°è£…
â”‚           â”‚   â”‚   â”œâ”€â”€ TaskController.kt            # ä»»åŠ¡é˜Ÿåˆ—æ§åˆ¶å™¨
â”‚           â”‚   â”‚   â””â”€â”€ HttpServerService.kt         # å†…åµŒHTTPæœåŠ¡å™¨
â”‚           â”‚   â”œâ”€â”€ model/
â”‚           â”‚   â”‚   â””â”€â”€ Models.kt              # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚           â”‚   â””â”€â”€ utils/
â”‚           â”‚       â””â”€â”€ NodeHelper.kt          # æ§ä»¶æŸ¥æ‰¾å·¥å…·ç±»
â”‚           â””â”€â”€ res/
â”‚               â”œâ”€â”€ xml/accessibility_service_config.xml
â”‚               â””â”€â”€ values/strings.xml
â”‚
â”œâ”€â”€ server/                                   # ===== Python æœåŠ¡ç«¯ =====
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ app.py                            # FastAPI åº”ç”¨ï¼ˆç»Ÿä¸€APIç½‘å…³ï¼‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ device_client.py                  # è®¾å¤‡APIå®¢æˆ·ç«¯ï¼ˆPython SDKï¼‰
â”‚   â”‚   â””â”€â”€ device_manager.py                 # å¤šè®¾å¤‡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ __init__.py                       # æœåŠ¡ç«¯é…ç½®
â”‚   â”œâ”€â”€ demo.py                               # äº¤äº’å¼ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ requirements.txt                      # Python ä¾èµ–
â”‚
â””â”€â”€ README.md                                 # æœ¬æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å®‰è£… Android ç«¯

**ç¯å¢ƒè¦æ±‚ï¼š**
- Android Studio Hedgehog+
- JDK 17
- Android 7.0+ è®¾å¤‡ï¼ˆç‰©ç†æ‰‹æœºæˆ–äº‘æ‰‹æœºï¼‰
- ä¼ä¸šå¾®ä¿¡ 4.1.x ~ 5.x

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/MrRobot2658/wechat-rpa-demo.git

# 2. ç”¨ Android Studio æ‰“å¼€ android-app ç›®å½•
# 3. Sync Gradleï¼Œç„¶å Build -> Build APK(s)
# 4. å®‰è£… APK åˆ°æ‰‹æœº
```

**æ‰‹æœºç«¯æ“ä½œï¼š**
1. æ‰“å¼€ **WeChat RPA** åº”ç”¨
2. ç‚¹å‡»ã€Œ**å¼€å¯æ— éšœç¢æœåŠ¡**ã€â†’ åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æ‰¾åˆ°å¹¶å¯ç”¨ "WeChat RPA"
3. ç‚¹å‡»ã€Œ**å¯åŠ¨HTTPæœåŠ¡å™¨**ã€
4. ç¡®è®¤çŠ¶æ€æ˜¾ç¤ºä¸º "ğŸŸ¢ ç³»ç»Ÿå°±ç»ª"
5. è®°å½•æ‰‹æœºçš„ IP åœ°å€ï¼ˆè®¾ç½® â†’ WLAN â†’ æŸ¥çœ‹IPï¼‰

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½² Python æœåŠ¡ç«¯

```bash
cd server

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ä¿®æ”¹é…ç½®ï¼šå°† DEVICE_API_BASE æ”¹ä¸ºæ‰‹æœºçš„å®é™…IP
# ç¼–è¾‘ server/config/__init__.py

# å¯åŠ¨æœåŠ¡ç«¯
python -m uvicorn api.app:app --host 0.0.0.0 --port 8080

# è®¿é—® Swagger API æ–‡æ¡£
# http://localhost:8080/docs
```

### ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨ Python SDK æˆ– Demo

**æ–¹å¼ä¸€ï¼šäº¤äº’å¼ Demo**

```bash
cd server
python demo.py
```

**æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨ SDK**

```python
from server.core import DeviceClient

# è¿æ¥è®¾å¤‡
client = DeviceClient("http://192.168.1.100:9527")

# æ£€æŸ¥è®¾å¤‡çŠ¶æ€
print(client.is_ready())        # True
print(client.get_status())      # {'accessibility_enabled': True, ...}

# å‘é€æ¶ˆæ¯
client.send_message("å¼ ä¸‰", "ä½ å¥½ï¼Œè¿™æ˜¯è‡ªåŠ¨å‘é€çš„æ¶ˆæ¯")

# è¯»å–æœ€æ–°æ¶ˆæ¯
result = client.read_messages("å¼ ä¸‰", count=5)

# åˆ›å»ºç¾¤èŠ
client.create_group("é¡¹ç›®è®¨è®ºç¾¤", ["å¼ ä¸‰", "æå››", "ç‹äº”"])

# é‚€è¯·å…¥ç¾¤
client.invite_to_group("é¡¹ç›®è®¨è®ºç¾¤", ["èµµå…­", "é’±ä¸ƒ"])

# è·å–ç¾¤æˆå‘˜åˆ—è¡¨
members = client.get_group_members("é¡¹ç›®è®¨è®ºç¾¤")

# ç§»é™¤ç¾¤æˆå‘˜
client.remove_from_group("é¡¹ç›®è®¨è®ºç¾¤", ["é’±ä¸ƒ"])

# å¯¼å‡ºæ§ä»¶æ ‘ï¼ˆè°ƒè¯•ç”¨ï¼‰
ui_tree = client.dump_ui_tree()
```

**æ–¹å¼ä¸‰ï¼šç›´æ¥è°ƒç”¨ Android ç«¯ HTTP API**

```bash
# å‘é€æ¶ˆæ¯
curl -X POST http://192.168.1.100:9527/api/send_message \
  -H "Content-Type: application/json" \
  -d '{"contact": "å¼ ä¸‰", "message": "ä½ å¥½"}'

# è¯»å–æ¶ˆæ¯
curl -X POST http://192.168.1.100:9527/api/read_messages \
  -H "Content-Type: application/json" \
  -d '{"contact": "å¼ ä¸‰", "count": 10}'

# åˆ›å»ºç¾¤èŠ
curl -X POST http://192.168.1.100:9527/api/create_group \
  -H "Content-Type: application/json" \
  -d '{"group_name": "æµ‹è¯•ç¾¤", "members": ["å¼ ä¸‰", "æå››"]}'

# é‚€è¯·å…¥ç¾¤
curl -X POST http://192.168.1.100:9527/api/invite_to_group \
  -H "Content-Type: application/json" \
  -d '{"group_name": "æµ‹è¯•ç¾¤", "members": ["ç‹äº”"]}'

# è·å–ç¾¤æˆå‘˜
curl -X POST http://192.168.1.100:9527/api/get_group_members \
  -H "Content-Type: application/json" \
  -d '{"group_name": "æµ‹è¯•ç¾¤"}'

# æŸ¥çœ‹è®¾å¤‡çŠ¶æ€
curl http://192.168.1.100:9527/api/status

# å¯¼å‡ºæ§ä»¶æ ‘
curl http://192.168.1.100:9527/api/dump_ui
```

## API å®Œæ•´å‚è€ƒ

### Android ç«¯ APIï¼ˆç«¯å£ 9527ï¼‰

| æ–¹æ³• | è·¯å¾„ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|
| GET | `/api/status` | - | è·å–æœåŠ¡çŠ¶æ€ |
| POST | `/api/send_message` | `contact`, `message` | å‘é€æ–‡æœ¬æ¶ˆæ¯ |
| POST | `/api/read_messages` | `contact`, `count` | è¯»å–æœ€æ–°æ¶ˆæ¯ |
| POST | `/api/create_group` | `group_name`, `members[]` | åˆ›å»ºç¾¤èŠ |
| POST | `/api/invite_to_group` | `group_name`, `members[]` | é‚€è¯·å…¥ç¾¤ |
| POST | `/api/remove_from_group` | `group_name`, `members[]` | ç§»é™¤ç¾¤æˆå‘˜ |
| POST | `/api/get_group_members` | `group_name` | è·å–ç¾¤æˆå‘˜åˆ—è¡¨ |
| GET | `/api/dump_ui` | - | å¯¼å‡ºæ§ä»¶æ ‘ï¼ˆè°ƒè¯•ï¼‰ |
| GET | `/api/task_result/{id}` | - | æŸ¥è¯¢å¼‚æ­¥ä»»åŠ¡ç»“æœ |

### Python æœåŠ¡ç«¯ APIï¼ˆç«¯å£ 8080ï¼‰

å¯åŠ¨åè®¿é—® `http://localhost:8080/docs` æŸ¥çœ‹å®Œæ•´çš„ Swagger äº¤äº’æ–‡æ¡£ã€‚

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/devices` | è·å–æ‰€æœ‰è®¾å¤‡åˆ—è¡¨ |
| GET | `/api/devices/online` | è·å–åœ¨çº¿è®¾å¤‡ |
| GET | `/api/devices/{id}/status` | è·å–è®¾å¤‡è¯¦ç»†çŠ¶æ€ |
| POST | `/api/send_message` | å‘é€æ¶ˆæ¯ï¼ˆæŒ‡å®šè®¾å¤‡ï¼‰ |
| POST | `/api/read_messages` | è¯»å–æ¶ˆæ¯ï¼ˆæŒ‡å®šè®¾å¤‡ï¼‰ |
| POST | `/api/create_group` | åˆ›å»ºç¾¤èŠ |
| POST | `/api/invite_to_group` | é‚€è¯·å…¥ç¾¤ |
| POST | `/api/remove_from_group` | ç§»é™¤ç¾¤æˆå‘˜ |
| POST | `/api/get_group_members` | è·å–ç¾¤æˆå‘˜ |
| POST | `/api/broadcast` | å‘æ‰€æœ‰åœ¨çº¿è®¾å¤‡å¹¿æ’­æ¶ˆæ¯ |
| GET | `/api/devices/{id}/dump_ui` | å¯¼å‡ºæ§ä»¶æ ‘ |

## æ§ä»¶IDæ ¡å‡†æŒ‡å—

ä¼ä¸šå¾®ä¿¡æ¯æ¬¡ç‰ˆæœ¬æ›´æ–°éƒ½å¯èƒ½å¯¼è‡´æ§ä»¶çš„ `resource-id` å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ˜¯ UI è‡ªåŠ¨åŒ–æ–¹æ¡ˆçš„å›ºæœ‰æŒ‘æˆ˜ã€‚

**æ ¡å‡†æ­¥éª¤ï¼š**

```bash
# 1. åœ¨æ‰‹æœºä¸Šæ‰“å¼€ä¼ä¸šå¾®ä¿¡ï¼Œè¿›å…¥ç›®æ ‡é¡µé¢ï¼ˆå¦‚èŠå¤©é¡µé¢ï¼‰

# 2. è°ƒç”¨å¯¼å‡ºæ§ä»¶æ ‘API
curl http://192.168.1.100:9527/api/dump_ui | python -m json.tool

# 3. åœ¨è¾“å‡ºçš„æ§ä»¶æ ‘ä¸­æœç´¢ç›®æ ‡å…ƒç´ 
#    ä¾‹å¦‚æœç´¢ "å‘é€" æŒ‰é’®ã€"æœç´¢" è¾“å…¥æ¡†ç­‰

# 4. æ›´æ–° WeworkOperator.kt ä¸­ WeworkIds å¯¹è±¡çš„å¸¸é‡å€¼
#    ä¾‹å¦‚: const val CHAT_SEND_BTN = "com.tencent.wework:id/æ–°ID"

# 5. é‡æ–°ç¼–è¯‘å®‰è£… APK
```

**æ¨èå·¥å…·ï¼š** ä½¿ç”¨ Android Studio çš„ **Layout Inspector** æˆ– `uiautomatorviewer` å¯ä»¥æ›´ç›´è§‚åœ°æŸ¥çœ‹æ§ä»¶å±‚çº§ã€‚

## æ ¸å¿ƒæŠ€æœ¯åŸç†

### AccessibilityService å·¥ä½œæœºåˆ¶

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Android ç³»ç»Ÿ    â”‚
                    â”‚  AccessibilityManager
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ æ³¨å†Œ/å›è°ƒ
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RpaAccessibilityService                 â”‚
â”‚                                                  â”‚
â”‚  onServiceConnected()                            â”‚
â”‚    â†’ æœåŠ¡å¯åŠ¨ï¼Œè·å–ç³»ç»Ÿçº§æƒé™                       â”‚
â”‚                                                  â”‚
â”‚  onAccessibilityEvent(event)                     â”‚
â”‚    â†’ ç›‘å¬çª—å£å˜åŒ–ã€å†…å®¹å˜åŒ–ç­‰äº‹ä»¶                   â”‚
â”‚    â†’ è®°å½•å½“å‰å‰å°åº”ç”¨åŒ…åå’ŒActivity                 â”‚
â”‚                                                  â”‚
â”‚  rootInActiveWindow                              â”‚
â”‚    â†’ è·å–å½“å‰çª—å£çš„å®Œæ•´æ§ä»¶æ ‘                       â”‚
â”‚    â†’ éå†æ ‘æŸ¥æ‰¾ç›®æ ‡æ§ä»¶                            â”‚
â”‚                                                  â”‚
â”‚  performAction()                                 â”‚
â”‚    â†’ ACTION_CLICK: æ¨¡æ‹Ÿç‚¹å‡»                       â”‚
â”‚    â†’ ACTION_SET_TEXT: è¾“å…¥æ–‡æœ¬                     â”‚
â”‚    â†’ ACTION_SCROLL_FORWARD: æ»šåŠ¨                  â”‚
â”‚                                                  â”‚
â”‚  dispatchGesture()                               â”‚
â”‚    â†’ æ¨¡æ‹Ÿå¤æ‚æ‰‹åŠ¿ï¼ˆæ»‘åŠ¨ã€é•¿æŒ‰ç­‰ï¼‰                   â”‚
â”‚    â†’ å½“ performAction å¤±æ•ˆæ—¶çš„å…œåº•æ–¹æ¡ˆ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç±»èŒè´£

| ç±» | å±‚çº§ | èŒè´£ |
|----|------|------|
| `RpaAccessibilityService` | ç³»ç»Ÿå±‚ | Androidæ— éšœç¢æœåŠ¡ï¼Œæä¾›æ§ä»¶æŸ¥æ‰¾å’Œæ¨¡æ‹Ÿæ“ä½œçš„åº•å±‚èƒ½åŠ› |
| `NodeHelper` | å·¥å…·å±‚ | å°è£…å¸¸ç”¨çš„æ§ä»¶æŸ¥æ‰¾æ–¹æ³•ï¼ˆæŒ‰ID/æ–‡æœ¬/ç±»å/æ»šåŠ¨æŸ¥æ‰¾ç­‰ï¼‰ |
| `WeworkOperator` | ä¸šåŠ¡å±‚ | å°è£…ä¼ä¸šå¾®ä¿¡çš„å…·ä½“æ“ä½œæµç¨‹ï¼ˆæœç´¢ã€å‘æ¶ˆæ¯ã€æ‹‰ç¾¤ã€ç¾¤ç®¡ç†ç­‰ï¼‰ |
| `TaskController` | è°ƒåº¦å±‚ | ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ï¼Œç¡®ä¿UIæ“ä½œä¸²è¡Œæ‰§è¡Œï¼Œé¿å…å†²çª |
| `HttpServerService` | æ¥å£å±‚ | åŸºäºNanoHTTPDçš„HTTPæœåŠ¡å™¨ï¼Œå°†æ“ä½œèƒ½åŠ›æš´éœ²ä¸ºREST API |
| `DeviceClient` | SDKå±‚ | Pythonå®¢æˆ·ç«¯ï¼Œå°è£…HTTPè°ƒç”¨ï¼Œæä¾›ç®€æ´çš„Python API |
| `DeviceManager` | ç®¡ç†å±‚ | å¤šè®¾å¤‡ç®¡ç†ï¼Œæ”¯æŒè®¾å¤‡æ³¨å†Œã€çŠ¶æ€ç›‘æ§ã€ä»»åŠ¡åˆ†å‘ |

### å¤šè´¦å·æ‰˜ç®¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Python æœåŠ¡ç«¯ (FastAPI)          â”‚
â”‚          DeviceManager å¤šè®¾å¤‡ç®¡ç†          â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚          â”‚          â”‚
   â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚è®¾å¤‡ 1 â”‚  â”‚è®¾å¤‡ 2 â”‚  â”‚è®¾å¤‡ N â”‚    â† ç‰©ç†æ‰‹æœº / äº‘æ‰‹æœº
â”‚ä¼å¾®A  â”‚  â”‚ä¼å¾®B  â”‚  â”‚ä¼å¾®N  â”‚
â”‚:9527  â”‚  â”‚:9527  â”‚  â”‚:9527  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

æ¯å°è®¾å¤‡ç‹¬ç«‹è¿è¡Œ RPA Appï¼ŒPython æœåŠ¡ç«¯é€šè¿‡ HTTP API ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ã€‚

## é£é™©æç¤º

1. **å°å·é£é™©**ï¼šè‡ªåŠ¨åŒ–æ“ä½œä¼ä¸šå¾®ä¿¡å­˜åœ¨è¿åå…¶ç”¨æˆ·åè®®çš„é£é™©ï¼Œå¯èƒ½å¯¼è‡´è´¦å·è¢«é™åˆ¶æˆ–å°ç¦ã€‚
2. **ç‰ˆæœ¬å…¼å®¹**ï¼šä¼ä¸šå¾®ä¿¡ç‰ˆæœ¬æ›´æ–°ä¼šå¯¼è‡´æ§ä»¶IDå˜åŒ–ï¼Œéœ€è¦å®šæœŸæ ¡å‡† `WeworkIds`ã€‚
3. **æ“ä½œèŠ‚å¥**ï¼šä»£ç ä¸­å·²å†…ç½®éšæœºå»¶è¿Ÿæ¨¡æ‹Ÿäººç±»æ“ä½œèŠ‚å¥ï¼Œä½†ä¸èƒ½å®Œå…¨è§„é¿é£æ§ã€‚
4. **å¼‚å¸¸å¤„ç†**ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦è¡¥å……æ›´å®Œå–„çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼ˆå¼¹çª—å¤„ç†ã€ç½‘ç»œå¼‚å¸¸ã€åº”ç”¨å´©æºƒæ¢å¤ç­‰ï¼‰ã€‚
5. **åˆè§„ä½¿ç”¨**ï¼šè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œå¹³å°è§„åˆ™ï¼Œä»…ç”¨äºåˆæ³•åˆè§„çš„åœºæ™¯ã€‚

## å‚è€ƒé¡¹ç›®

- [WorkTool](https://github.com/gallonyin/worktool) - ä¼å¾®æ— éšœç¢æœåŠ¡æœºå™¨äººï¼ˆ3k+ Starsï¼Œæœ¬é¡¹ç›®æ¶æ„å‚è€ƒï¼‰
- [openatx/uiautomator2](https://github.com/openatx/uiautomator2) - Android UIè‡ªåŠ¨åŒ–æ¡†æ¶ï¼ˆæ—§æ–¹æ¡ˆå‚è€ƒï¼‰
- [NanoHTTPD](https://github.com/NanoHttpd/nanohttpd) - è½»é‡çº§Java HTTPæœåŠ¡å™¨

## License

Apache License 2.0
